---
swagger: "2.0"
info:
  x-ibm-name: "recommendations"
  title: "Recommendations"
  version: "1.0.6-RC"
schemes:
- "https"
host: "$(catalog.host)"
basePath: "/recommendations/r1/v1"
consumes:
- "application/json"
produces:
- "application/json"
securityDefinitions:
  clientSecretHeader:
    type: "apiKey"
    description: ""
    in: "header"
    name: "X-IBM-Client-Secret"
  clientIdHeader:
    type: "apiKey"
    in: "header"
    name: "X-IBM-Client-Id"
security:
- clientIdHeader: []
  clientSecretHeader: []
x-ibm-configuration:
  testable: true
  enforced: true
  cors:
    enabled: true
  assembly:
    execute:
    - set-variable:
        title: "set-api-variables"
        actions:
        - set: "api_region"
          value: "r1"
        - set: "api_version"
          value: "v1"
    - set-variable:
        title: "set-http-credentials"
        actions:
        - value: "cencoappuser"
          add: "http_user"
        - value: "HjztW7dQL7Y8XJ5cZbpfgMHb"
          add: "http_pass"
        version: "1.0.0"
    - set-variable:
        title: "set-base-url"
        actions:
        - value: "https://cencouat-recommendation-service.mybluemix.net"
          add: "base-url"
    - invoke:
        title: "invoke"
        timeout: 10
        verb: "GET"
        cache-response: "protocol"
        cache-ttl: 900
        stop-on-error:
        - null
        version: "1.0.0"
        target-url: "$(base-url)/recommendations/getRecommendedProducts?type=$(request.parameters.type)&productId=$(request.parameters.productId)&categoryId=$(request.parameters.categoryId)&tagId=$(request.parameters.tagId)&deviceId=$(request.parameters.deviceId)&userId=$(request.parameters.userId)&useBoughtProducts=$(request.parameters.useBoughtProducts)&useCartProducts=$(request.parameters.useCartProducts)&useVisitedProducts=$(request.parameters.useVisitedProducts)&size=$(request.parameters.size)&email=$(request.parameters.email)"
        username: "$(http_user)"
        password: "$(http_pass)"
    - map:
        title: "map"
        inputs:
          input:
            schema:
              type: "object"
            variable: "message.body"
        outputs:
          output:
            schema:
              $ref: "#/definitions/productsResponse"
            variable: "message.body"
        actions:
        - set: "output.metadata.requestTime"
          default: "$(request.date)"
        - set: "output.metadata.region"
          default: "$(api_region)"
        - set: "output.metadata.version"
          default: "$(api_version)"
        - set: "output.metadata.results"
          default: "$(message.body.length)"
        - set: "output.recommendations"
          from: "input"
    catch: []
  phase: "realized"
paths:
  /recommendations/products:
    get:
      responses:
        200:
          description: "200 OK"
          schema:
            $ref: "#/definitions/productsResponse"
      parameters:
      - name: "type"
        type: "string"
        required: true
        in: "query"
        description: "Recommendation type: Similar, FrequentlyBoughtTogether, EndedUpBuying,\
          \ BestSellers, MostVisited, Trending"
      - name: "productId"
        type: "array"
        required: false
        in: "query"
        description: "Product identification"
        items:
          type: "string"
      - name: "categoryId"
        type: "array"
        required: false
        in: "query"
        description: "Category identification"
        items:
          type: "string"
      - name: "tagId"
        type: "array"
        required: false
        in: "query"
        description: "Tag Identification"
        items:
          type: "string"
      - name: "deviceId"
        type: "string"
        required: false
        in: "query"
        description: "Device Identification"
      - name: "userId"
        type: "string"
        required: false
        in: "query"
        description: "User identification"
      - name: "useBoughtProducts"
        type: "string"
        required: false
        in: "query"
        description: "Use bought products flag"
      - name: "useCartProducts"
        type: "string"
        required: false
        in: "query"
        description: "Use cart products flag"
      - name: "useVisitedProducts"
        type: "string"
        required: false
        in: "query"
        description: "Use visited products flag"
      - name: "size"
        type: "integer"
        required: false
        in: "query"
        description: "Elements size"
        format: "int32"
      - name: "email"
        type: "string"
        required: true
        in: "query"
        description: "Email"
definitions:
  productsResponse:
    properties:
      metadata:
        description: "Response metadata"
        $ref: "#/definitions/metadata"
      recommendations:
        description: "Products list"
        type: "object"
    additionalProperties: false
  metadata:
    properties:
      results:
        type: "string"
        description: "Total Items"
        example: "10"
      requestTime:
        type: "string"
        description: "Api Request Time"
        example: "Thu, 24 Nov 2016 15:17:32 Z"
      region:
        type: "string"
        description: "API Region"
        example: "r1"
      version:
        type: "string"
        description: "API Version"
        example: "v1"
    additionalProperties: false
tags: []
